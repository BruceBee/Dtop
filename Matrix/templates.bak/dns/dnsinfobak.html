{% extends "V.html" %}

{% block head %}

<script type="text/javascript" src="/static/matrix/js/layer/layer.js"></script>
<script type="text/javascript" src="/static/matrix/js/dataBase.js"></script>
<script type="text/javascript" src="/static/matrix/js/preview/WdatePicker.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
      loadTable(1);
  });

  function addDialog(){
    var addTableHtml=$("#addTable").clone();
    var parameters=['id','Domain_name_id','dns_id','dns_name','l_type','r_type','ttl','record','mx_priority','status','is_enabled','updated_on','dnsop','remark',];
    $.each(arguments,function(num,val){
      var inputName=addTableHtml.find("input[name='"+parameters[num]+"']");
        inputName.attr("id",parameters[num]);
        if(val){
          inputName.attr("value",val);
        }
    });

    var buttonValue="添加";
    if(arguments[0]){
      buttonValue="更新";
    }

    layer.open({
          title:'编辑信息',
          type: 1,
          shift:2,
          skin: 'layui-layer-rim', //加上边框
          area: ['30%', '65%'], //宽高
          content:addTableHtml.html(),
          btn:[buttonValue,'取消'],
          yes:function(index){

            var ret='';
            $.each(parameters,function(){
              ret+=this+'='+$("#"+this).val()+'&';
            });
            ret+="hostop={{ true_name }}"
            //断点测试
            console.log(ret)
            $.ajax({
              type:'POST',
              url:'/dns_data/dnsinfo_editFunbak',
              data:ret,
              dataType:'text',
              success:function(val){
                layer.close(index);
                if(val=='1'){
                  loadTable(1);
                }else{
                  layer.alert(val);
                }
              },error:function(){
                layer.close(index);
                layer.alert("操作失败02");
              }
            });

          }
      });
  }

  function keyEnter(event){
     var e = event || window.event || arguments.callee.caller.arguments[0];
     if(e && e.keyCode==13){ // enter 键
             loadTable(1);
      return false;
          }

  }

  function loadTable(val){
     $("#dataFrom").find("input[name='page']").val(val);
     $("#dataTab").dataTable({
        title:'DNS信息详情',
        columns:[
        {key:'id',check:true,checkAll:true,width:'1%',align:'center'},
        {key:'Domain_name_id',name:'域名表ID',width:'5%',align:'center'},
        // {key:'domain_id',name:'域名表ID',width:'5%',align:'center'},
        {key:'dns_id',name:'DNS ID',width:'10%',align:'center'},
        {key:'dns_name',name:'主机记录',width:'10%',align:'center'},
        {key:'l_type',name:'线路类型',width:'5%',align:'center'},
        {key:'r_type',name:'记录类型',width:'5%',align:'center'},
        {key:'ttl',name:'TTL值',width:'5%',align:'center'},
        {key:'record',name:'记录值',width:'10%',align:'center'},
        {key:'mx_priority',name:'MX记录值',width:'5%',align:'center'},
        {key:'status',name:'记录状态',width:'5%',align:'center'},
        {key:'is_enabled',name:'启用状态',width:'5%',align:'center'},
        {key:'updated_on',name:'更新时间',width:'15%',align:'center'},
        {key:'dnsop',name:'操作人员',width:'10%',align:'center'},
        {key:'remark',name:'备注',width:'15%',align:'center'}],
        formid:'dataFrom',
        loadAfter:tab_trOnclick,
    });
  }

  /**
  行添加双击事件
  **/
  function tab_trOnclick(){
    var trs=$("#dataFrom_table tbody tr");
    for(var i=0;i<trs.length;i++){
      $(trs[i]).on("dblclick",function(){
        var tr=$(this);
        var tds=tr.find("td");
        var id=$(tds[0]).find("input").val();
        addDialog(id,$(tds[1]).text(),$(tds[2]).text(),$(tds[3]).text(),$(tds[4]).text(),$(tds[5]).text(),$(tds[6]).text(),$(tds[7]).text(),$(tds[8]).text(),$(tds[9]).text(),$(tds[10]).text(),$(tds[11]).text(),$(tds[12]).text(),$(tds[13]).text());
      });
    }
  }

  /**
  删除功能
  **/
  function delData(){
    var inputChecks=$("input:checkbox[name='dataFrom_check']:checked");
    if(inputChecks.length==0){
      layer.alert('请选中删除项！');
      return;
    }
    layer.confirm('确认删除?', {icon: 2, title:'提示'},function(index){
      var orders='';
      for(var i=0;i<inputChecks.length;i++){
        orders+=inputChecks[i].value;
        if(i!=inputChecks.length-1){
          orders+=',';
        }
      }
      $.ajax({
        type:'POST',
        url:'/dns_data/dnsinfo_deleteFun',
        dataType:'text',
        data:'id='+orders,
        success:function(text){
               layer.close(index);
               if(text=='1'){
                loadTable(1);
               }else{
                layer.alert('删除失败01');
               }
        },error:function(){
          layer.close(index);
          layer.alert('删除失败02');
        }
      });
    });

  }
</script>
{% endblock %}

{% block content %}
<!-- 承上连接V.html：content+content-header -->

  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span12">
   <!--aaa-->
    <form action="/dns_data/dnsinfo_pagedataList" id="dataFrom" onSubmit="return false">
      <input type="hidden" id="page" name="page" value="1"/>
        <input type="hidden" id="num" name="num" value="15"/>
        <div>
      <input class="btn btn-primary" type="button" name="addButton" value="添加" onclick="addDialog();" style="float:left;"/>
      {% if perms.delete_contenttype %}
      <input class="btn btn-danger" type="button" name="deleteButton" value="删除" onclick="delData();" style="float:left;"/>
      {% endif %}
        <input type="text" name="tj" placeholder="请输入关键字,回车查询" id="tj" style="background-color: white; float:right" onKeydown="keyEnter();"/>
    </div>
    </form>
  <div id="dataTab"></div>
    <!-- end aa-->

  <div id="addTable" style="display:none;">
      <center>
           <table border="0" style="color:#000;">
              <tr style="display:none;">
                <form action="/dns_data/dnsinfo_editFunbak" method="post">
                {{ form.as_p }}
                <input type='submit' value='ok'>
                </form>
            </table>
         </center>
   </div>

   </div>
   </div>
   </div>

{% endblock %}